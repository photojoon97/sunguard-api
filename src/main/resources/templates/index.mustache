<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> SUNGUARD </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>

<header class="bg-primary text-white text-center p-4 shadow-sm">
    <h1><i class="bi bi-bus-front"></i> SUNGUARD </h1>
</header>

<main class="container my-4">
    <div class="row g-4">
        <div class="col-lg-5">
            <div class="card">
                <div class="card-body">
                    {{#errorMessage}}
                        <div class="alert alert-danger" role="alert">
                            {{errorMessage}}
                        </div>
                    {{/errorMessage}}

                    <div class="mb-4">
                        <h5 class="card-title border-bottom pb-2 mb-3">경로 설정</h5>
                        <form id="route-form" action="/find-route" method="get">
                            <input type="hidden" name="bstopnm" value="{{searchKeyword}}">
                            <div class="mb-3">
                                <label for="departure" class="form-label">출발지</label>
                                <input type="text" id="departure" name="departureName" class="form-control" readonly placeholder="정류장을 검색하여 설정" value="{{#departure}}{{stationName}}{{/departure}}">
                                <input type="hidden" id="departureId" name="departureId" value="{{#departure}}{{bstopId}}{{/departure}}">
                            </div>
                            <div class="mb-3">
                                <label for="destination" class="form-label">목적지</label>
                                <input type="text" id="destination" name="destinationName" class="form-control" readonly placeholder="정류장을 검색하여 설정" value="{{#destination}}{{stationName}}{{/destination}}">
                                <input type="hidden" id="destinationId" name="destinationId" value="{{#destination}}{{bstopId}}{{/destination}}">
                            </div>
                            <button type="submit" class="btn btn-primary w-100"><i class="bi bi-sign-turn-right"></i> 경로 탐색</button>
                        </form>
                    </div>

                    <hr>

                    <div class="mt-4">
                        <h5 class="card-title border-bottom pb-2 mb-3">정류장 검색</h5>
                        <form id="search-form" action="/" method="get">
                            <div class="input-group">
                                <input type="text" id="bstopnm-input" name="bstopnm" class="form-control" placeholder="정류장 이름 입력" value="{{searchKeyword}}">
                                <button type="submit" class="btn btn-success"><i class="bi bi-search"></i> 검색</button>
                            </div>
                        </form>
                    </div>

                    {{#searchResultContainer}}
                        <div class="mt-4">
                            <h6>"{{keyword}}" 검색 결과</h6>
                            <ul class="list-group" style="max-height: 250px; overflow-y: auto;">
                                {{#results}}
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span>{{stationName}} <small class="text-muted">({{bstopId}})</small></span>
                                        <a href="/?bstopId={{bstopId}}&stationName={{stationName}}" class="btn btn-sm btn-outline-primary details-link">정보</a>
                                    </li>
                                {{/results}}
                            </ul>
                        </div>
                    {{/searchResultContainer}}
                </div>
            </div>
        </div>

        <div class="col-lg-7">
            <div class="card">
                <div class="card-body">
                    {{^selectedStopId}}
                        {{^routeResult}}
                            <div class="text-center text-muted p-5">
                                <i class="bi bi-info-circle" style="font-size: 2rem;"></i>
                                <p class="mt-2">정류장을 검색하거나 경로를 탐색해주세요.</p>
                            </div>
                        {{/routeResult}}
                    {{/selectedStopId}}

                    {{#selectedStopId}}
                        <div id="stop-details">
                            <h5 class="card-title"><i class="bi bi-geo-alt-fill"></i> 정류장 상세 정보</h5>
                            <ul class="list-group list-group-flush mb-3">
                                <li class="list-group-item"><strong>정류장 이름:</strong> {{selectedStopName}}</li>
                                <li class="list-group-item"><strong>정류장 ID:</strong> {{selectedStopId}}</li>
                            </ul>

                            <div class="d-grid gap-2 d-md-flex">
                                <button type="button" class="btn btn-info flex-fill"
                                        id="set-departure-btn"
                                        data-stop-name="{{selectedStopName}}"
                                        data-stop-id="{{selectedStopId}}">출발지로 설정</button>

                                <button type="button" class="btn btn-warning flex-fill"
                                        id="set-destination-btn"
                                        data-stop-name="{{selectedStopName}}"
                                        data-stop-id="{{selectedStopId}}">목적지로 설정</button>
                            </div>

                            <h6 class="mt-4">도착 예정 버스</h6>
                            <ul class="list-group">
                                {{#arrivalInfo}}
                                    <li class="list-group-item">
                                        <strong><i class="bi bi-bus-front-fill"></i> {{lineNo}}번 버스</strong>
                                        {{#remainingTime}}
                                            <span class="float-end">{{remainingTime}} ({{remainingStops}} 정류장 전)</span>
                                        {{/remainingTime}}
                                        {{^remainingTime}}
                                            <span class="float-end text-muted">도착 정보 없음</span>
                                        {{/remainingTime}}
                                    </li>
                                {{/arrivalInfo}}
                                {{^arrivalInfo}}
                                    <li class="list-group-item text-muted">도착 예정인 버스가 없습니다.</li>
                                {{/arrivalInfo}}
                            </ul>
                        </div>
                    {{/selectedStopId}}

                    {{#routeResult}}
                        <div id="route-result">
                            <h5 class="card-title"><i class="bi bi-map-fill"></i> 경로 탐색 결과</h5>
                            <p class="lead"><strong>총 예상 이동 거리:</strong> {{totalDistance}} km (환승 {{transferCount}}회)</p>
                            <hr class="my-4">
                            {{#steps}}
                                <div class="mb-3 position-relative ps-3">
                                    <strong style="position: absolute; left: -5px; top: 0;"><i class="bi bi-circle-fill text-primary"></i></strong>
                                    <p class="mb-1"><strong>{{lineNum}}번 버스 탑승</strong></p>
                                    <ul class="list-unstyled ps-3">
                                        <li><small><strong>승차:</strong> {{startStopName}} ({{startStopId}})</small></li>
                                        <li><small><strong>하차:</strong> {{endStopName}} ({{endStopId}})</small></li>
                                        <li><small><strong>이동:</strong> {{stopCount}}개 정류장</small></li>
                                    </ul>
                                </div>
                            {{/steps}}
                        </div>
                    {{/routeResult}}
                </div>
            </div>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="/js/sunguard.js"></script>
</body>
</html>